APP=function(a,b){var c=function(){d(),e(),f(),g(),$(".index").length&&j(),k(),m(),n(),$(".order").length&&""!==$(".order-input").val()&&$(".order-input").trigger("keyup")},d=function(){$(b).on("click",".checkout-btn",function(){$(".checkout").removeClass("none"),$(".products").addClass("none"),$("footer").addClass("none"),$("html, body").animate({scrollTop:0},"fast");var a=$(".coupon-form input").val();return _.isEmpty(a)||$(".coupon-form").trigger("submit"),l(),!1})},e=function(){$(b).on("click",".back-btn",function(){return $(".checkout").addClass("none"),$(".products").removeClass("none"),$("footer").removeClass("none"),$("html, body").animate({scrollTop:0},"fast"),!1})},f=function(){$(b).on("click",".control-count",function(a){var b=$(this).closest(".product").find("input"),c=parseInt($(b).val())||0;$(this).hasClass("minus-btn")?c>0?$(b).val(c-1):$(b).val(0):$(b).val(c+1),h(),i()})},g=function(){$(b).on("keyup",".count input",function(){var a=$(this).val();""!==a&&($(this).val(a.replace(/\D/g,"")),$(this).val(parseInt(a,10))),h(),i()})},h=function(){var a=0;$(".count input").each(function(b,c){var d=$(c),e=parseInt(d.val());_.isNumber(e)&&""!==d.val()?a+=e:(console.log("here"),d.val(0)),a<=0?($(".nobreads").removeClass("none"),$(".total-breads").addClass("none"),$(".checkout-btn").addClass("none")):($(".nobreads").addClass("none"),$(".total-breads").removeClass("none"),$(".checkout-btn").removeClass("none")),$(".total-breads--count").text(a)})},i=function(){var a=0;$(".count input").each(function(b,c){var d=$(c),e=parseInt(d.val());if(_.isNumber(e)&&""!==d.val()&&"0"!==d.val()){var f=$(c).closest(".product").attr("data-id"),g=$(c).closest(".product").find(".picture").css("background-image").replace("url(","").replace(")","").replace(/\"/gi,""),h=$(c).closest(".product").attr("data-name"),i=$(c).closest(".product").attr("data-price"),j=e,k=i*j;$(".product-ordered--list tbody tr[data-pid="+f+"]").length?($(".product-ordered--list tbody tr[data-pid="+f+"] .product-ordered--price-text").text(GENERAL.currency(k)),$(".product-ordered--list tbody tr[data-pid="+f+"] .product-ordered--count-text").text(GENERAL.currency(j))):$(".product-ordered--list tbody").append('<tr data-pid="'+f+'"><td><div class="product-ordered--image" style="background-image: url('+g+')"></div></td><td><p class="product-ordered--desc">'+h+'</p></td><td><p class="product-ordered--count"><span class="product-ordered--count-text">'+j+'</span><small class="availability-status">Checking availability...</small></p></td><td><p class="product-ordered--price">Rp <span class="product-ordered--price-text">'+GENERAL.currency(i*j)+"</span></p></td></tr>"),a+=k,$(".product-ordered--list tbody tr[data-pid="+f+"]").attr("data-count",j),$(".product-ordered--list tbody tr[data-pid="+f+"]").attr("data-price",i),$(".product-ordered--list tbody tr[data-pid="+f+"]").attr("data-total",k),$(".product-ordered--total-subtotal").text(GENERAL.currency(a));var l=parseInt($(".product-ordered--total-subtotal").text().replace(/,/g,""))+parseInt($(".product-ordered--total-shipping").text().replace(/,/g,""))-parseInt($(".product-ordered--total-coupon").text().replace(/,/g,""));$(".product-ordered--total-final").text(GENERAL.currency(l))}else{var f=$(c).closest(".product").attr("data-id");$(".product-ordered--list tbody tr[data-pid="+f+"]").remove()}})},j=function(){$.ajax({url:"/api/breads",method:"GET",dataType:"json"}).done(function(a){var b=a.data;_.forEach(b,function(a,b){var c=a.amount<=0?" soldout":"",d=a.amount<=0?'<div class="soldout-label">SOLD OUT</div>':'<div class="control"><div class="control-count minus-btn">-</div><div class="count"><input type="text" value="0"></div><div class="control-count plus-btn">+</div></div>';$(".products").append('<div class="product'+c+'" data-id="'+a._id+'" data-name="'+a.name+'" data-price="'+a.price+'"><div class="picture" style="background-image: url('+a.image+')"></div>'+d+"</div>")})}).fail(function(a){console.log(a)})},k=function(){$(b).on("submit",".coupon-form",function(a){a.preventDefault();var b=$(".coupon-form input").val(),c=$(this),d=c.attr("action")+b;return""===b?(GENERAL.notifier("Enter your coupon code","error"),GENERAL.resetBtn(c,"Use coupon")):$.ajax({url:d,method:"GET",dataType:"json"}).done(function(a){var b=a.data;if(_.isEmpty(b))GENERAL.notifier("Coupon code no longer active","error"),$(".product-ordered--total-coupon").text(0),$(".product-ordered--total-percentage").text(""),$('.shipping-form input[name="coupon"]').val(""),i(),GENERAL.resetBtn(c,"Use coupon");else{GENERAL.notifier("Your coupon code has been applied","success");var d=$(".product-ordered--total-subtotal").text().replace(/,/g,""),e=d*(b.percentage/100);$(".product-ordered--total-coupon").text(GENERAL.currency(e)),$(".product-ordered--total-percentage").text(["-",b.percentage,"%"].join("")),$('.shipping-form input[name="coupon"]').val(b._id),i(),GENERAL.resetBtn(c,"Use coupon")}}).fail(function(a){console.log(a),GENERAL.resetBtn(c,"Use coupon")}),!1})},l=function(){$(".availability-status").text("Checking availability..."),$(".availability-status").removeClass("empty"),$(".product-ordered--list tr").each(function(a,b){var c=$(b),d=c.attr("data-pid"),e=parseInt(c.attr("data-count"));$.ajax({url:"/api/breads/check/"+d,method:"GET",dataType:"json"}).done(function(a){var b=a.data,d=b.amount;e<=d?(c.find(".availability-status").text("Available"),c.attr("data-available","true")):(c.find(".availability-status").text("Only left "+d),c.find(".availability-status").addClass("empty"),c.attr("data-available","false"))}).fail(function(a){c.find(".availability-status").text("There was a problem while checking the stock"),c.find(".availability-status").addClass("empty")});parseInt(c.val())})},m=function(){$(b).on("submit",".shipping-form",function(b){b.preventDefault();var c=$(this),d=c.attr("action"),e={name:c.find('input[name="name"]').val(),phone:c.find('input[name="phone"]').val(),email:c.find('input[name="email"]').val(),address:c.find('textarea[name="address"]').val(),coupon:c.find('input[name="coupon"]').val()};if(validator.isNull(e.name)||validator.isNull(e.name)||!validator.isEmail(e.email)||validator.isNull(e.address))GENERAL.notifier("Shipping details fields can't be empty","error"),GENERAL.resetBtn(c,"Submit order");else{var f=$('.product-ordered--list tr[data-available="false"]').length;if(f)GENERAL.notifier(f+" order item not available, buy another","error"),GENERAL.resetBtn(c,"Submit order");else{var g=[];$('.product-ordered--list tr[data-available="true"]').each(function(a,b){var c=$(b),d={product:c.attr("data-pid"),count:c.attr("data-count"),price:c.attr("data-price")};g.push(d)}),e.items=JSON.stringify(g),$.ajax({url:d,method:"POST",dataType:"json",data:e}).done(function(b){var d=b.data;GENERAL.resetBtn(c,"Redirecting..."),a.location="/order?id="+d.orderId}).fail(function(a){GENERAL.resetBtn(c,"Submit order")})}}return!1})},n=function(){$(b).on("keyup",".order-input",function(){var a=$(this).val().toLowerCase();GENERAL.delay(function(){""!==a?($(".store-profile h3").text("Checking your order..."),$.ajax({url:"/api/order/check/"+a,method:"GET",dataType:"json"}).done(function(a){var b=a.data;1===b.status?$(".store-profile h3").text("Breadstock has been recieved your order, please wait for verification"):2===b.status?$(".store-profile h3").text("Your breads is on the way! Shipping number: "+b.shippingCode):$(".store-profile h3").text("Not found")}).fail(function(a){GENERAL.notifier("There was a problem while checking your order, try again.","error"),$(".store-profile h3").text("")})):$(".store-profile h3").text("")},500)})};return{init:c}}(window,document),$(function(){APP.init()}),GENERAL=function(a,b){var c=function(){d(),e(),f(),k()},d=function(a,b){$(".ajax-messages").hide(),$("."+b+"-msg-ajax").show(),$("."+b+"-msg-ajax p").text(a),setTimeout(function(){$("."+b+"-msg-ajax").fadeOut(500)},5e3)},e=function(){$(".render-messages").length&&setTimeout(function(){$(".render-messages").fadeOut(500)},3e3)},f=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},g=function(b,c){c||(c=a.location.href),b=b.replace(/[\[\]]/g,"\\$&");var d=new RegExp("[?&]"+b+"(=([^&#]*)|&|#|$)"),e=d.exec(c);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null},h=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},i=function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},j=function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}(),k=function(){$(b).on("keyup focus","input.phone-validator",function(){var a=$(this),b=$(this).val();j(function(){"+62"!==b.substring(0,3)&&(a.prop("required")?a.val("+62"):""!==b&&a.val("+62"))},500)})},l=function(a,b){a.find("button").prop("disabled",!1),a.find("button").text(b)};return{init:c,notifier:d,getUuid:f,getParameterByName:g,capitalize:h,delay:j,currency:i,resetBtn:l}}(window,document),$(function(){GENERAL.init()});